<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title></title>
    <meta name="author" content="" />
    <meta name="description" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      body {
        background-color: black;
        color: white;
      }
    </style>
  </head>

  <body>
    <p>Hello, world!</p>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
  </body>
  <script>
    let button = document.createElement('button');
    button.textContent = 'Test';
    button.onclick = function() {
      let h1 = document.createElement('h1');
      h1.textContent =
        "When I first brought my cat home from the humane society she was a mangy, pitiful animal. It cost a lot to adopt her: forty dollars. And then I had to buy litter, a litterbox, food, and dishes for her to eat out of. Two days after she came home with me she got taken to the pound by the animal warden. There's a leash law for cats in Fort Collins. If they're not in your yard they have to be on a leash. Anyway, my cat is my best friend.I'm glad I got her. She sleeps under the covers with me when it's cold. Sometimes she meows a lot in the middle of the night and wakes me up, though When I first brought my cat home from the Humane Society she was a mangy, pitiful animal. She was so thin that you could count her vertebrae just by looking at her. Apparently she was declawed by her previous owners, then abandoned or lost. Since she couldn't hunt, she nearly starved. Not only that, but she had an abscess on one hip. The vets at the Humane Society had drained it, but it was still scabby and without fur. She had a terrible cold, to@2o. She was sneezing and sniffling and her meow was just a hoarse squeak. And she'd lost half her tail somewhere. Instead of tapering gracefully, it had a bony knob at the end";
      document.body.appendChild(h1);
      window.parent.postMessage('clicked button', '*');
    };
    document.body.appendChild(button);

    function highlight(color) {
      let _selection = window.getSelection();
      if (_selection) {
        if (_selection.getRangeAt(0)) {
          let _range = _selection.getRangeAt(0);
          var _span = document.createElement('span');

          _span.style.backgroundColor = color;
          _span.style.display = 'inline';

          let range = _range.cloneRange();
          range.surroundContents(_span);
          _selection.removeAllRanges();
          _selection.addRange(range);
        }
      }
    }

    document.onmouseup = function(event) {
      window.parent.postMessage('highlighted text', '*');
    };

    window.parent.addEventListener('message', function(e) {
      console.log('This is the color I got: ' + JSON.stringify(e.data));
      let data = e.data;
      highlight(data.color);
    });
  </script>
</html>
